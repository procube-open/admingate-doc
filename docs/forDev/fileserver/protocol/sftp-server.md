---
sidebar_position: 30
---
# SFTP
ベースとなるパッケージとして`ssh2`を用いる。
FTPと異なる点のみ以下に記す。

### ログイン方法
作業IDでログインし、送信元IP制限をかけるのはFTPと同様。

ただし、FTPのユーザ名で`anonymous`でログインする形にあたるものはSFTPでは実装しない。
SFTPは作業IDとパスワードでのみログインを許可する。

また、パスワード認証方式のみ対応し、公開鍵認証には対応しない。

### サーバー認証
サーバー認証で用いられる秘密鍵は環境変数で文字列として指定できる。環境変数は以下のとおり。

- SERVER_PRIVATE_KEY : サーバー認証用の秘密鍵（必須）
- SERVER_PRIVATE_KEY_PASSPHRASE :  サーバー認証用の秘密鍵のパスフレーズ（任意）

### ファイル一覧（ファイルフォーマット）
longnameのオーナー、およびグループ名に、作業ディレクトリとその配下にあるディレクトリとファイルは`作業ID`、publicディレクトリとその配下にあるディレクトリとファイルは`public`を表示する。名称は8桁になるよう空白で補完する
> 作業IDは大文字英字と数字のランダムな羅列で合計文字数は固定で5文字

### renameの動作
renameはFTPとSFTPで動作に相違があるため、以下に明記する。（SFTPのrenameはlinuxのmvコマンドに近い。ただし完全に一致ではない）

- 変更先に"/"を含む値（ディレクトリを含むパス）を許可する。FTPではエラーとなる
- 変更元と変更先の親ディレクトリが異なるパターンの変更も可能とする
- 変更先に既に存在するディレクトリのパスが指定された場合は、変更元がファイルかディレクトリかに関係なくエラーとする

[参考]
> 変更先に"/"を含む値が許可されることで、SFTPでは親ディレクトリが変更されるようなリネーム（移動）ができるのに対し、FTPでは変更元のディレクトリ名（親ディレクトリまでは同じ）に対して変更先の名前でリネームが行われる

### ディレクトリ削除

SFTPでは空ディレクトリしか削除できない。
配下にファイル、もしくはディレクトリが存在した場合はエラーが出力される。